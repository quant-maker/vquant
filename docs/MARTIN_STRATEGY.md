# Martin (Martingale) Trading Strategy - Enhanced with Safety Limits

## ç­–ç•¥è¯´æ˜

é©¬ä¸æ ¼å°”ç­–ç•¥æ˜¯ä¸€ç§åœ¨äºæŸæ—¶åŠ å€æŠ•èµ„çš„ç­–ç•¥ï¼Œç›®æ ‡æ˜¯é€šè¿‡å¢åŠ ä»“ä½æ¥å¹³å‡æˆæœ¬å¹¶åœ¨ä»·æ ¼åè½¬æ—¶æ”¶å›æŸå¤±ã€‚

**âš ï¸ æœ¬ç‰ˆæœ¬å·²å¢å¼ºé˜²çˆ†ä»“æœºåˆ¶ï¼ŒåŒ…å«å¤šé‡å®‰å…¨ä¿æŠ¤ï¼**

### æ ¸å¿ƒé€»è¾‘

1. **åˆå§‹å¼€ä»“**: ä»¥åŸºç¡€ä»“ä½ï¼ˆbase_volumeï¼‰å»ºç«‹å¤šå¤´ä»“ä½
2. **æŒä»“ç®¡ç†**:
   - å¦‚æœç›ˆåˆ©è¾¾åˆ°ç›®æ ‡ï¼ˆprofit_targetï¼‰â†’ å¹³ä»“è·åˆ©ï¼Œé‡ç½®å€æ•°
   - å¦‚æœäºæŸè¾¾åˆ°é˜ˆå€¼ï¼ˆloss_thresholdï¼‰â†’ åŠ å€ä»“ä½ï¼ˆé©¬ä¸æ ¼å°”ï¼‰
3. **å€æ•°ç®¡ç†**:
   - ç›ˆåˆ©åé‡ç½®ä¸º 1x
   - æ¯æ¬¡äºæŸåå€æ•°ç¿»å€ï¼ˆ1x â†’ 2x â†’ 4x â†’ 8xï¼‰
   - æœ€å¤§å€æ•°å— max_multiplier é™åˆ¶

### ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶ï¼ˆé˜²çˆ†ä»“ï¼‰

æœ¬ç­–ç•¥åŒ…å« **7 å±‚å®‰å…¨ä¿æŠ¤** é˜²æ­¢çˆ†ä»“ï¼š

#### 1. ç¡¬æ­¢æŸï¼ˆHard Stop Lossï¼‰
- å½“å•ç¬”æŒä»“äºæŸè¾¾åˆ° `hard_stop_loss`ï¼ˆé»˜è®¤ -5%ï¼‰æ—¶**å¼ºåˆ¶å¹³ä»“**
- æ— è§†å…¶ä»–æ¡ä»¶ï¼Œç«‹å³å…³é—­æ‰€æœ‰ä»“ä½
- é˜²æ­¢å•ç¬”äº¤æ˜“é€ æˆå·¨å¤§æŸå¤±

#### 2. æœ€å¤§å›æ’¤é™åˆ¶ï¼ˆMax Drawdownï¼‰
- è¿½è¸ªè´¦æˆ· P&L å³°å€¼ï¼Œè®¡ç®—å›æ’¤å¹…åº¦
- å½“å›æ’¤è¶…è¿‡ `max_drawdown`ï¼ˆé»˜è®¤ -10%ï¼‰æ—¶**å¼ºåˆ¶å¹³ä»“**
- ä¿æŠ¤è´¦æˆ·ä¸ä¼šä»ç›ˆåˆ©è½¬ä¸ºå·¨é¢äºæŸ

#### 3. æœ€å¤§æŒä»“é™åˆ¶ï¼ˆMax Positionï¼‰
- é™åˆ¶æ€»æŒä»“é‡ä¸è¶…è¿‡ `max_total_position`ï¼ˆé»˜è®¤ 0.5ï¼‰
- è¶…è¿‡é™åˆ¶æ—¶**é˜»æ­¢åŠ ä»“**ï¼Œç­‰å¾…ç°æœ‰ä»“ä½å¹³ä»“

#### 4. ä»“ä½ä»·å€¼é™åˆ¶ï¼ˆPosition Value Limitï¼‰
- é™åˆ¶æŒä»“ä»·å€¼ä¸è¶…è¿‡è´¦æˆ·ä½™é¢çš„ `max_position_pct`ï¼ˆé»˜è®¤ 30%ï¼‰
- ä¾‹å¦‚ï¼šè´¦æˆ· 10000 USDTï¼ŒæŒä»“ä»·å€¼ä¸èƒ½è¶…è¿‡ 3000 USDT
- é˜²æ­¢è¿‡åº¦æ æ†å¯¼è‡´çˆ†ä»“

#### 5. å†·å´æœŸæœºåˆ¶ï¼ˆCooldown Periodï¼‰
- è¿ç»­äºæŸ `cooldown_after_losses` æ¬¡ï¼ˆé»˜è®¤ 3 æ¬¡ï¼‰åè¿›å…¥å†·å´æœŸ
- å†·å´æœŸå†…**æš‚åœæ‰€æœ‰äº¤æ˜“**ï¼ŒæŒç»­ `cooldown_duration` ç§’ï¼ˆé»˜è®¤ 1 å°æ—¶ï¼‰
- ç»™ç­–ç•¥"å†·é™"çš„æ—¶é—´ï¼Œé¿å…è¿ç»­äºæŸ

#### 6. ç´§æ€¥åœæ­¢å¼€å…³ï¼ˆEmergency Stopï¼‰
- æ‰‹åŠ¨è®¾ç½® `emergency_stop: true` å¯ç«‹å³åœæ­¢ç­–ç•¥
- æˆ–ç³»ç»Ÿæ£€æµ‹åˆ°ä¸¥é‡é£é™©æ—¶è‡ªåŠ¨è§¦å‘
- è§¦å‘åéœ€è¦æ‰‹åŠ¨é‡ç½®æ‰èƒ½æ¢å¤äº¤æ˜“

#### 7. äº¤æ˜“æ—¶é—´é—´éš”ï¼ˆMin Trade Intervalï¼‰
- é™åˆ¶ä¸¤æ¬¡äº¤æ˜“ä¹‹é—´çš„æœ€å°æ—¶é—´é—´éš”
- é˜²æ­¢é«˜é¢‘äº¤æ˜“å’Œæƒ…ç»ªåŒ–æ“ä½œ

### é…ç½®å‚æ•°

#### åŸºç¡€äº¤æ˜“å‚æ•°
```json
{
  "symbol": "BTCUSDC",
  "base_volume": 0.01,          // åŸºç¡€äº¤æ˜“é‡
  "max_volume": 1.0,            // å•æ¬¡æœ€å¤§äº¤æ˜“é‡
  "max_multiplier": 8,          // æœ€å¤§å€æ•°ï¼ˆ2^3 = 8ï¼‰
  "profit_target": 0.5,         // æ­¢ç›ˆç™¾åˆ†æ¯” (%)
  "loss_threshold": -0.5,       // è§¦å‘é©¬ä¸çš„äºæŸç™¾åˆ†æ¯” (%)
  "min_trade_interval": 300     // æœ€å°äº¤æ˜“é—´éš”ï¼ˆç§’ï¼‰
}
```

#### ğŸ›¡ï¸ å®‰å…¨å‚æ•°ï¼ˆé˜²çˆ†ä»“ï¼‰
```json
{
  "max_total_position": 0.5,    // æœ€å¤§æ€»æŒä»“é‡
  "hard_stop_loss": -5.0,       // ç¡¬æ­¢æŸç™¾åˆ†æ¯” (%) - å¼ºåˆ¶å¹³ä»“
  "max_drawdown": -10.0,        // æœ€å¤§å›æ’¤ç™¾åˆ†æ¯” (%) - å¼ºåˆ¶å¹³ä»“
  "account_balance": 10000.0,   // è´¦æˆ·ä½™é¢ï¼ˆç”¨äºè®¡ç®—ä»“ä½æ¯”ä¾‹ï¼‰
  "max_position_pct": 0.3,      // æœ€å¤§ä»“ä½å è´¦æˆ·ä½™é¢æ¯”ä¾‹ (0.3 = 30%)
  "cooldown_after_losses": 3,   // è¿ç»­äºæŸå‡ æ¬¡åè¿›å…¥å†·å´æœŸ
  "cooldown_duration": 3600,    // å†·å´æœŸæ—¶é•¿ï¼ˆç§’ï¼‰
  "emergency_stop": false       // ç´§æ€¥åœæ­¢å¼€å…³
}
```

### å®‰å…¨é˜ˆå€¼è®¾ç½®å»ºè®®

| é£é™©åå¥½ | hard_stop_loss | max_drawdown | max_position_pct | cooldown_after_losses |
|---------|----------------|--------------|------------------|---------------------|
| æä¿å®ˆ  | -3%            | -5%          | 20%              | 2                   |
| ä¿å®ˆ    | -5%            | -10%         | 30%              | 3                   |
| ä¸­ç­‰    | -8%            | -15%         | 40%              | 4                   |
| æ¿€è¿›    | -10%           | -20%         | 50%              | 5                   |

### ä»“ä½è®¡ç®—

- ç¬¬1æ¬¡äº¤æ˜“: base_volume Ã— 1 = 0.01
- ç¬¬2æ¬¡äº¤æ˜“ï¼ˆäºæŸåï¼‰: base_volume Ã— 2 = 0.02
- ç¬¬3æ¬¡äº¤æ˜“ï¼ˆå†äºæŸï¼‰: base_volume Ã— 4 = 0.04
- ç¬¬4æ¬¡äº¤æ˜“ï¼ˆå†äºæŸï¼‰: base_volume Ã— 8 = 0.08
- ç›ˆåˆ©åé‡ç½®ä¸º: base_volume Ã— 1 = 0.01

### çŠ¶æ€è¿½è¸ª

MartinTrader ä¼šæŒä¹…åŒ–ä¿å­˜ä»¥ä¸‹çŠ¶æ€ï¼š

```json
{
  "symbol": "BTCUSDC",
  "current_position": 0.05,        // å½“å‰æŒä»“é‡
  "entry_price": 42000.0,          // å¹³å‡å…¥åœºä»·æ ¼
  "current_multiplier": 4,         // å½“å‰å€æ•°
  "consecutive_losses": 2,         // è¿ç»­äºæŸæ¬¡æ•°
  "last_trade_time": "2025-12-24T10:30:00",
  "last_trade_action": "buy",
  "last_trade_volume": 0.04,
  "total_pnl": -1.2,               // æ€»ç›ˆäºç™¾åˆ†æ¯”
  "trade_count": 15,               // æ€»äº¤æ˜“æ¬¡æ•°
  "win_count": 8,                  // è·èƒœæ¬¡æ•°
  "peak_pnl": 5.5,                 // å³°å€¼ç›ˆåˆ©ï¼ˆç”¨äºå›æ’¤è®¡ç®—ï¼‰
  "cooldown_until": null,          // å†·å´æœŸç»“æŸæ—¶é—´
  "emergency_stop_triggered": false, // æ˜¯å¦è§¦å‘ç´§æ€¥åœæ­¢
  "max_position_reached": 0.08     // å†å²æœ€å¤§æŒä»“
}
```

## ä½¿ç”¨æ–¹æ³•

### 1. åˆ›å»ºé…ç½®æ–‡ä»¶

```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®
cp config/martin_test.json config/martin_mybot.json

# ç¼–è¾‘é…ç½®
nano config/martin_mybot.json
```

### 2. è¿è¡Œç­–ç•¥

```bash
# åŸºæœ¬ç”¨æ³•
python main.py --symbol BTCUSDC --interval 1h --predictor martin --name mybot

# è¯¦ç»†æ—¥å¿—
python main.py --symbol BTCUSDC --interval 1h --predictor martin --name mybot --verbose

# å®ç›˜äº¤æ˜“ï¼ˆè°¨æ…ï¼ï¼‰
python main.py --symbol BTCUSDC --interval 1h --predictor martin --name mybot --trade
```

### 3. æŸ¥çœ‹çŠ¶æ€

```bash
# æŸ¥çœ‹æŒä¹…åŒ–çŠ¶æ€
cat data/martin_state_mybot.json

# æŸ¥çœ‹äº¤æ˜“ç»“æœ
cat charts/mybot_*.json
```

## äº¤æ˜“ä¿¡å·ç¤ºä¾‹

### åˆå§‹å¼€ä»“ï¼ˆå¸¦å®‰å…¨æ£€æŸ¥ï¼‰
```json
{
  "action": "buy",
  "volume": 0.01,
  "current_price": 42000.0,
  "reasoning": "Initial entry at $42000.00 with base volume 0.01"
}
```

### é©¬ä¸åŠ ä»“ï¼ˆäºæŸæ—¶ï¼‰
```json
{
  "action": "buy",
  "volume": 0.02,
  "current_price": 41800.0,
  "pnl_pct": -0.48,
  "multiplier": 2,
  "reasoning": "Martingale: P&L -0.48% <= -0.5%, adding 0.02 (multiplier: 2x)"
}
```

### é©¬ä¸åŠ ä»“è¢«é˜»æ­¢ï¼ˆè¶…è¿‡å®‰å…¨é™åˆ¶ï¼‰
```json
{
  "action": "hold",
  "volume": 0.0,
  "current_price": 41500.0,
  "pnl_pct": -1.2,
  "reasoning": "Martingale BLOCKED: Position value 35.0% > 30.0% of balance (P&L: -1.20%)"
}
```

### ç¡¬æ­¢æŸå¼ºåˆ¶å¹³ä»“
```json
{
  "action": "close",
  "volume": 0.07,
  "current_price": 40000.0,
  "pnl_pct": -5.1,
  "reasoning": "FORCED CLOSE: Hard stop loss: -5.10% <= -5.00%"
}
```

### å†·å´æœŸæ‹’ç»äº¤æ˜“
```json
{
  "action": "hold",
  "volume": 0.0,
  "current_price": 41900.0,
  "reasoning": "In cooldown period after consecutive losses"
}
```

### æ­¢ç›ˆå¹³ä»“
```json
{
  "action": "close",
  "volume": 0.03,
  "current_price": 42300.0,
  "pnl_pct": 0.52,
  "reasoning": "Taking profit: P&L 0.52% >= target 0.5% (entry: $42150.00, current: $42300.00)"
}
```

## é£é™©æç¤ºä¸å®‰å…¨æªæ–½

### âœ… å·²å®ç°çš„å®‰å…¨ä¿æŠ¤

è™½ç„¶é©¬ä¸æ ¼å°”ç­–ç•¥ä»æœ‰é£é™©ï¼Œä½†æœ¬å®ç°åŒ…å«äº†å¤šå±‚ä¿æŠ¤ï¼š

1. **ç¡¬æ­¢æŸä¿æŠ¤**: å•ç¬”äºæŸè¾¾åˆ° -5% æ—¶å¼ºåˆ¶æ­¢æŸ
2. **è´¦æˆ·ä¿æŠ¤**: æ€»å›æ’¤è¾¾åˆ° -10% æ—¶å¼ºåˆ¶å¹³ä»“
3. **ä»“ä½é™åˆ¶**: æŒä»“ä¸è¶…è¿‡è´¦æˆ· 30%ï¼Œé˜²æ­¢è¿‡åº¦æ æ†
4. **å†·å´æœºåˆ¶**: 3 è¿äºåæš‚åœ 1 å°æ—¶ï¼Œé¿å…æƒ…ç»ªåŒ–è¿ç»­åŠ ä»“
5. **ç´§æ€¥å¼€å…³**: éšæ—¶å¯æ‰‹åŠ¨åœæ­¢ç­–ç•¥
6. **ä»“ä½ç›‘æ§**: å®æ—¶è¿½è¸ªæŒä»“é‡ï¼Œè¶…é™é˜»æ­¢åŠ ä»“
7. **å³°å€¼è¿½è¸ª**: è®°å½•æœ€é«˜ç›ˆåˆ©ï¼Œè®¡ç®—å›æ’¤ä¿æŠ¤åˆ©æ¶¦

### âš ï¸ ä»éœ€æ³¨æ„çš„é£é™©

1. **æç«¯è¡Œæƒ…**: å•è¾¹è¿ç»­ä¸‹è·Œå¯èƒ½å¿«é€Ÿè§¦å‘æ­¢æŸ
2. **æ»‘ç‚¹é£é™©**: å¿«é€Ÿè¡Œæƒ…ä¸‹å¯èƒ½æ— æ³•ç²¾ç¡®æ‰§è¡Œæ­¢æŸä»·
3. **èµ„é‡‘è¦æ±‚**: å³ä½¿æœ‰é™åˆ¶ï¼Œä»éœ€è¶³å¤Ÿèµ„é‡‘åº”å¯¹å¤šæ¬¡åŠ ä»“
4. **ç­–ç•¥é€‚ç”¨æ€§**: åªé€‚åˆéœ‡è¡å¸‚ï¼Œä¸é€‚åˆè¶‹åŠ¿å¸‚

### ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **èµ„é‡‘é…ç½®**:
   - è´¦æˆ·ä½™é¢è®¾ç½®ä¸ºå®é™…ä½™é¢çš„ **50-70%**ï¼ˆç•™å®‰å…¨è¾¹é™…ï¼‰
   - ç¡®ä¿æœ‰è¶³å¤Ÿèµ„é‡‘åº”å¯¹ max_multiplier æ¬¡åŠ å€
   - è®¡ç®—å…¬å¼ï¼šæ‰€éœ€èµ„é‡‘ â‰¥ base_volume Ã— (2^max_multiplier - 1) Ã— ä»·æ ¼ Ã— 3

2. **å‚æ•°è®¾ç½®**:
   - æ–°æ‰‹ä½¿ç”¨**æä¿å®ˆ**é…ç½®
   - è§‚å¯Ÿè‡³å°‘ 100 ç¬”äº¤æ˜“åå†è°ƒæ•´
   - æ ¹æ®å¸ç§æ³¢åŠ¨ç‡è°ƒæ•´ loss_threshold

3. **ç›‘æ§å‘Šè­¦**:
   ```bash
   # ç›‘æ§è„šæœ¬ç¤ºä¾‹
   watch -n 60 'cat data/martin_state_mybot.json | jq "{position, pnl, losses: .consecutive_losses, cooldown: .cooldown_until}"'
   ```

4. **å®šæœŸç»´æŠ¤**:
   - æ¯å‘¨æ£€æŸ¥æ€» P&L å’Œèƒœç‡
   - è§¦å‘ç´§æ€¥åœæ­¢ååˆ†æåŸå› å†é‡å¯
   - å†·å´æœŸç»“æŸåè¯„ä¼°å¸‚åœºå†ç»§ç»­

## ä¼˜åŒ–å»ºè®®

### ä¿å®ˆé…ç½®ï¼ˆæ¨èæ–°æ‰‹ï¼‰
```json
{
  "base_volume": 0.005,
  "max_volume": 0.1,
  "max_multiplier": 4,      // æœ€å¤šç¿»2æ¬¡å€
  "profit_target": 0.3,
  "loss_threshold": -0.3
}
```

### æ¿€è¿›é…ç½®ï¼ˆé£é™©é«˜ï¼‰
```json
{
  "base_volume": 0.01,
  "max_volume": 1.0,
  "max_multiplier": 16,     // æœ€å¤šç¿»4æ¬¡å€
  "profit_target": 0.8,
  "loss_threshold": -0.8
}
```

## æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹èƒœç‡å’Œç›ˆäº
python -c "
import json
with open('data/martin_state_mybot.json') as f:
    state = json.load(f)
    win_rate = state['win_count'] / state['trade_count'] * 100 if state['trade_count'] > 0 else 0
    print(f'Total trades: {state[\"trade_count\"]}')
    print(f'Win rate: {win_rate:.1f}%')
    print(f'Total P&L: {state[\"total_pnl\"]:.2f}%')
    print(f'Current multiplier: {state[\"current_multiplier\"]}x')
    print(f'Current position: {state[\"current_position\"]}')
"
```

## ä¸ Wave ç­–ç•¥çš„å¯¹æ¯”

| ç‰¹æ€§ | Wave Trader | Martin Trader |
|------|-------------|---------------|
| ç­–ç•¥ç±»å‹ | å›ºå®šä»“ä½æ³¢æ®µ | é©¬ä¸æ ¼å°”åŠ ä»“ |
| ä»“ä½ç®¡ç† | å›ºå®š | åŠ¨æ€åŠ å€ |
| é£é™©ç­‰çº§ | ä¸­ç­‰ | é«˜ |
| èµ„é‡‘è¦æ±‚ | è¾ƒä½ | é«˜ |
| é€‚ç”¨åœºæ™¯ | éœ‡è¡å¸‚ | çŸ­æœŸå›è°ƒ |
| è¿ç»­äºæŸå¤„ç† | ç»§ç»­å›ºå®šä»“ä½ | åŠ å€ä»“ä½ |

## å®æˆ˜å»ºè®®

1. **å…ˆæ¨¡æ‹Ÿæµ‹è¯•**: ä½¿ç”¨å°èµ„é‡‘å’Œä¿å®ˆé…ç½®æµ‹è¯•è‡³å°‘1-2å‘¨
2. **ç›‘æ§èƒœç‡**: å¦‚æœèƒœç‡ < 50%ï¼Œè¯´æ˜ç­–ç•¥ä¸é€‚åˆå½“å‰å¸‚åœº
3. **è®¾ç½®è­¦æŠ¥**: å½“ consecutive_losses >= 3 æ—¶æ”¶åˆ°é€šçŸ¥
4. **å®šæœŸé‡ç½®**: å¦‚æœè¿ç»­äºæŸè¿‡å¤šï¼Œè€ƒè™‘æš‚åœç­–ç•¥å¹¶é‡ç½®çŠ¶æ€
5. **èµ„é‡‘ç®¡ç†**: ç¡®ä¿è´¦æˆ·èµ„é‡‘ >= base_volume Ã— (2^max_multiplier - 1) Ã— 10

## å¸¸è§é—®é¢˜

**Q: ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘é©¬ä¸åŠ ä»“ï¼Ÿ**
A: å½“æŒä»“äºæŸè¾¾åˆ° loss_thresholdï¼ˆå¦‚ -0.5%ï¼‰æ—¶è§¦å‘ã€‚

**Q: æœ€å¤šä¼šåŠ ä»“å‡ æ¬¡ï¼Ÿ**
A: ç”± max_multiplier å†³å®šã€‚ä¾‹å¦‚ max_multiplier=8ï¼Œæœ€å¤šåŠ åˆ° 8 å€ï¼ˆ3æ¬¡åŠ å€ï¼‰ã€‚

**Q: å¦‚æœä¸€ç›´äºæŸæ€ä¹ˆåŠï¼Ÿ**
A: è¾¾åˆ° max_volume æˆ– max_multiplier åä¸å†åŠ ä»“ï¼Œéœ€è¦ç­‰å¾…ä»·æ ¼å›å‡æˆ–æ‰‹åŠ¨ä»‹å…¥ã€‚

**Q: å¯ä»¥åšç©ºå—ï¼Ÿ**
A: å½“å‰å®ç°ä¸»è¦é’ˆå¯¹åšå¤šï¼Œä½†ä»£ç æ”¯æŒè´Ÿä»“ä½ï¼ˆåšç©ºï¼‰ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ã€‚

**Q: å¦‚ä½•é‡ç½®ç­–ç•¥ï¼Ÿ**
A: åˆ é™¤æˆ–æ¸…ç©º `data/martin_state_{name}.json` æ–‡ä»¶å³å¯é‡ç½®æ‰€æœ‰çŠ¶æ€ã€‚
